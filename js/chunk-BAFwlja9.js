import{d as t,u as a,r as e,h as l,a as o,b as n,t as s,j as c,m as r,F as i,a5 as p,a6 as d,a7 as u,o as b}from"./chunk-7McyaHaY.js";import{_ as g}from"./chunk-C2aLKJYZ.js";import{i as m,p as h}from"./chunk-BhGQo3Ao.js";import{r as v}from"./chunk-Dv7RK_ed.js";const f={class:"modal-box"},x={class:"text-lg font-bold"},C={class:"py-4"},_={class:"modal-action"},y={method:"dialog",class:"flex gap-3"},N={class:"min-w-1000px"},k={class:"flex gap-3"},S={class:""},A={for:"explore"},D=["data-tip"],j={class:"btn btn-primary btn-sm"},w=t({__name:"PersonSummary",setup(t){const{t:w}=a(),z=new Map,E=e([]),J=e();async function O(t){const a=await v(t.target.files[0]),e=p(a,{type:"binary",cellDates:!0}),l=e.Sheets[e.SheetNames[0]],o=d.sheet_to_json(l);o.forEach(t=>{t.contact=t.phone||t.orderNo,t.contactDesensitized=h(t.contact),t.voteCount=t.count,t.phone&&delete t.orderNo}),M(),o.length<=0||(o.forEach(t=>{const a=E.value.find(a=>t.phone&&a.phone===t.phone);a?a.voteCount=a.voteCount+t.voteCount:E.value.push(t)}),E.value.sort((t,a)=>a.voteCount-t.voteCount).forEach((t,a)=>{if(t.id=a,z.has(t.contact))t.uid=z.get(t.contact);else{const a=z.size+1;t.uid=`U202503${a.toString().padStart(7,"0")}`,z.set(t.contact,t.uid)}}))}function T(){let t=JSON.parse(JSON.stringify(E.value));for(let e=0;e<t.length;e++)delete t[e].id,delete t[e].contact,delete t[e].count;let a=JSON.stringify(t);if(a=a.replaceAll(/uid/g,m.global.t("data.number")).replaceAll(/contactDesensitized/g,m.global.t("data.contact")).replaceAll(/phone/g,m.global.t("data.phone")).replaceAll(/orderNo/g,m.global.t("data.orderNo")).replaceAll(/name/g,m.global.t("data.name")).replaceAll(/voteCount/g,m.global.t("data.voteCount")),t=JSON.parse(a),t.length>0){const a=d.json_to_sheet(t),e=d.book_new();d.book_append_sheet(e,a,"Sheet1"),u(e,"result_data.xlsx")}}function M(){E.value=[]}const P=[{label:m.global.t("data.number"),props:"uid"},{label:m.global.t("data.name"),props:"name"},{label:m.global.t("data.phone"),props:"phone"},{label:m.global.t("data.orderNo"),props:"orderNo"},{label:m.global.t("data.contact"),props:"contactDesensitized"},{label:m.global.t("data.voteCount"),props:"voteCount"}];return l(()=>{}),(t,a)=>(b(),o(i,null,[n("dialog",{id:"my_modal_1",ref_key:"delAllDataDialog",ref:J,class:"border-none modal"},[n("div",f,[n("h3",x,s(c(w)("dialog.titleTip")),1),n("p",C,s(c(w)("dialog.dialogDelAllPerson")),1),n("div",_,[n("form",y,[n("button",{class:"btn",onClick:a[0]||(a[0]=t=>J.value.close())},s(c(w)("button.cancel")),1),n("button",{class:"btn",onClick:M},s(c(w)("button.confirm")),1)])])])],512),n("div",N,[n("h2",null,s(c(w)("viewTitle.personManagement")),1),n("div",k,[n("div",S,[n("label",A,[n("div",{class:"tooltip tooltip-bottom","data-tip":c(w)("tooltip.uploadExcelTip")},[n("input",{id:"explore",type:"file",class:"",style:{display:"none"},accept:".xlsx,.xls",onChange:O},null,32),n("span",j,s(c(w)("button.importData")),1)],8,D)])]),n("button",{class:"btn btn-accent btn-sm",onClick:T},s(c(w)("button.exportResult")),1),n("div",null,[a[1]||(a[1]=n("span",null,"总人数:",-1)),n("span",null,s(E.value.length),1)]),n("div",null,[a[2]||(a[2]=n("span",null,"总票数:",-1)),n("span",null,s(E.value.reduce((t,a)=>t+(a.voteCount||0),0)),1)])]),r(g,{"table-columns":P,data:E.value},null,8,["data"])])],64))}});export{w as default};
