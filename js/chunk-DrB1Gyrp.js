import{d as a,u as l,s as t,r as e,h as o,a as n,b as s,t as i,j as d,D as r,F as p,A as c,J as b,m as u,a5 as m,a6 as g,a7 as f,o as v,C as y}from"./chunk-7McyaHaY.js";import{_ as h}from"./chunk-C2aLKJYZ.js";import{u as x,i as k,a as C}from"./chunk-BhGQo3Ao.js";import{r as _}from"./chunk-Dv7RK_ed.js";const A={class:"modal-box"},z={class:"text-lg font-bold"},N={class:"py-4"},T={class:"modal-action"},w={method:"dialog",class:"flex gap-3"},D={class:"modal-box"},j={class:"text-lg font-bold"},P={class:"py-4"},W={class:"modal-action"},S={method:"dialog",class:"flex gap-3"},G={class:"modal-box"},J={class:"text-lg font-bold"},M={class:"py-4"},O={class:"flex w-full gap-3"},I=["onClick"],L={class:"py-4"},R={for:"explore"},E=["data-tip"],F={class:"w-32 btn btn-primary"},V={class:"modal-action"},$={method:"dialog",class:"flex gap-3"},q={class:"min-w-1000px"},B={class:"flex gap-3"},H=["data-tip"],K=["download","href"],Q=a({__name:"PersonAll",setup(a){const{t:Q}=l(),U=x().personConfig,X=x().prizeConfig,{getAllPersonList:Y,getAlreadyPersonList:Z}=t(U),{getPrizeConfig:aa}=t(X),la=e(),ta=e(),ea=e(),oa=e();async function na(a){const l=await _(a.target.files[0]),t=m(l,{type:"binary",cellDates:!0}),e=t.Sheets[t.SheetNames[0]],o=g.sheet_to_json(e),n=(Y.value.length>0?Math.max(...Y.value.map(a=>a.id)):0)+1,s=C(o,la.value,n);U.addNotPersonList(s),la.value.personCount+=s.length,la.value.votedCount+=s.reduce((a,l)=>a+(l.voteCount||0),0)}function sa(){let a=JSON.parse(JSON.stringify(Y.value));for(let t=0;t<a.length;t++)delete a[t].x,delete a[t].y,delete a[t].id,delete a[t].createTime,delete a[t].updateTime,delete a[t].prizeId,delete a[t].prizeGroupId,a[t].isWin?a[t].isWin=k.global.t("data.yes"):a[t].isWin=k.global.t("data.no"),a[t].prizeTime=a[t].prizeTime.join(","),a[t].prizeName=a[t].prizeName.join(",");let l=JSON.stringify(a);if(l=l.replaceAll(/uid/g,k.global.t("data.number")).replaceAll(/contact/g,k.global.t("data.contact")).replaceAll(/isWin/g,k.global.t("data.isWin")).replaceAll(/department/g,k.global.t("data.department")).replaceAll(/name/g,k.global.t("data.name")).replaceAll(/identity/g,k.global.t("data.identity")).replaceAll(/prizeName/g,k.global.t("data.prizeName")).replaceAll(/prizeTime/g,k.global.t("data.prizeTime")).replaceAll(/voteCount/g,k.global.t("data.voteCount")).replaceAll(/prizeGroupName/g,k.global.t("data.prizeGroup")),a=JSON.parse(l),a.length>0){const l=g.json_to_sheet(a),t=g.book_new();g.book_append_sheet(t,l,"Sheet1"),f(t,"data.xlsx")}}function ia(){U.resetAlreadyPerson()}function da(){U.deleteAllPerson()}const ra=[{label:k.global.t("data.number"),props:"uid"},{label:k.global.t("data.name"),props:"name"},{label:k.global.t("data.contact"),props:"contact"},{label:k.global.t("data.voteCount"),props:"voteCount"},{label:k.global.t("data.prizeGroup"),props:"prizeGroupName"},{label:k.global.t("data.isWin"),props:"isWin",formatValue:a=>a.isWin?k.global.t("data.yes"):k.global.t("data.no")}];return o(()=>{}),(a,l)=>(v(),n(p,null,[s("dialog",{id:"my_modal_1",ref_key:"resetDataDialog",ref:ta,class:"border-none modal"},[s("div",A,[s("h3",z,i(d(Q)("dialog.titleTip")),1),s("p",N,i(d(Q)("dialog.dialogResetWinner")),1),s("div",T,[s("form",w,[s("button",{class:"btn",onClick:l[0]||(l[0]=a=>ta.value.close())},i(d(Q)("button.cancel")),1),s("button",{class:"btn",onClick:ia},i(d(Q)("button.confirm")),1)])])])],512),s("dialog",{id:"my_modal_1",ref_key:"delAllDataDialog",ref:ea,class:"border-none modal"},[s("div",D,[s("h3",j,i(d(Q)("dialog.titleTip")),1),s("p",P,i(d(Q)("dialog.dialogDelAllPerson")),1),s("div",W,[s("form",S,[s("button",{class:"btn",onClick:l[1]||(l[1]=a=>ea.value.close())},i(d(Q)("button.cancel")),1),s("button",{class:"btn",onClick:da},i(d(Q)("button.confirm")),1)])])])],512),s("dialog",{id:"my_modal_1",ref_key:"importDataDialog",ref:oa,class:"border-none modal"},[s("div",G,[s("h3",J,i(d(Q)("dialog.titleTip")),1),s("p",M,i(d(Q)("dialog.dialogImportData")),1),s("div",O,[(v(!0),n(p,null,c(d(aa),a=>{var l;return v(),n("button",{key:a.id,class:y(["btn btn-sm",(null==(l=la.value)?void 0:l.id)===a.id?"btn-primary":"btn-outline"]),onClick:l=>{return t=a,void(la.value=t);var t}},i(a.name),11,I)}),128))]),r(s("div",L,[s("label",R,[s("div",{class:"tooltip tooltip-bottom","data-tip":d(Q)("tooltip.uploadExcelTip")},[s("input",{id:"explore",type:"file",class:"",style:{display:"none"},accept:".xlsx,.xls",onChange:na},null,32),s("span",F,i(d(Q)("button.upload")),1)],8,E)])],512),[[b,la.value]]),s("div",V,[s("form",$,[s("button",{class:"btn",onClick:l[2]||(l[2]=a=>oa.value.close())},i(d(Q)("button.close")),1)])])])],512),s("div",q,[s("h2",null,i(d(Q)("viewTitle.personManagement")),1),s("div",B,[s("button",{class:"btn btn-error btn-sm",onClick:l[3]||(l[3]=a=>ea.value.showModal())},i(d(Q)("button.allDelete")),1),s("div",{class:"tooltip tooltip-bottom","data-tip":d(Q)("tooltip.downloadTemplateTip")},[s("a",{class:"no-underline btn btn-secondary btn-sm",download:d(Q)("data.xlsxName"),target:"_blank",href:`/log-lottery/${d(Q)("data.xlsxName")}`},i(d(Q)("button.downloadTemplate")),9,K)],8,H),s("button",{class:"btn btn-primary btn-sm",onClick:l[4]||(l[4]=a=>oa.value.showModal())},i(d(Q)("button.importData")),1),s("button",{class:"btn btn-error btn-sm",onClick:l[5]||(l[5]=a=>ta.value.showModal())},i(d(Q)("button.resetData")),1),s("button",{class:"btn btn-accent btn-sm",onClick:sa},i(d(Q)("button.exportResult")),1),s("div",null,[s("span",null,i(d(Q)("table.luckyPeopleNumber"))+":",1),s("span",null,i(d(Z).length),1),l[6]||(l[6]=s("span",null," / ",-1)),s("span",null,i(d(Y).length),1)])]),u(h,{"table-columns":ra,data:d(Y)},null,8,["data"])])],64))}});export{Q as default};
