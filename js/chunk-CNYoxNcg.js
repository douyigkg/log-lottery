import{d as a,u as e,s as t,r as l,h as o,a as s,o as n,b as r,m as u,p,t as i,j as v,n as d,F as c,A as m,ac as g,a5 as b,a6 as f}from"./chunk-7McyaHaY.js";import{_ as h}from"./chunk-C2aLKJYZ.js";import{u as C,i as y,a as x}from"./chunk-BhGQo3Ao.js";const _={class:"p-10"},k={class:"flex flex-row items-center"},w={class:"flex flex-row gap-2"},z=a({__name:"PersonAutoImport",setup(a){const z=d(),{t:j}=e(),P=C().personConfig,A=C().prizeConfig,{getAllPersonList:G}=t(P),{getPrizeConfig:I}=t(A),N=l([]),L=l(-1),S=l(!1);const T=[{label:y.global.t("data.number"),props:"uid"},{label:y.global.t("data.name"),props:"name"},{label:y.global.t("data.contact"),props:"contact"},{label:y.global.t("data.voteCount"),props:"voteCount"},{label:y.global.t("data.prizeGroup"),props:"prizeGroupName"}];return o(()=>{!async function(){if(N.value=I.value,G.value.length>0){for(let a=0;a<N.value.length;a++){const e=N.value[a];e.personCount=G.value.filter(a=>a.prizeGroupId===e.id).length,e.votedCount=G.value.filter(a=>a.prizeGroupId===e.id).reduce((a,e)=>a+(e.voteCount||0),0)}S.value=!0}else for(let a=0;a<N.value.length;a++){L.value=a,await new Promise(a=>setTimeout(a,1e3));const e=N.value[a],t=await g.get(`/log-lottery/人员登记表-${e.name}.xlsx`,{responseType:"arraybuffer"}),l=new Uint8Array(t.data),o=b(l,{type:"array",cellDates:!0}),s=o.Sheets[o.SheetNames[0]],n=f.sheet_to_json(s),r=(G.value.length>0?Math.max(...G.value.map(a=>a.id)):0)+1,u=x(n,e,r);P.addNotPersonList(u),e.personCount=u.length,e.votedCount=u.reduce((a,e)=>a+(e.voteCount||0),0),a===N.value.length-1&&(S.value=!0)}}()}),(a,e)=>{var t;return n(),s("div",_,[r("div",k,[r("h2",null,i(S.value?"导入完成":`导入中，正在导入：${(null==(t=N.value[L.value])?void 0:t.name)||"_"}`),1),S.value?(n(),s("button",{key:0,class:"btn btn-primary btn-md ml-5",onClick:e[0]||(e[0]=a=>v(z).back())},"开始抽奖")):p("",!0)]),r("div",w,[e[1]||(e[1]=r("p",null,"汇总：",-1)),(n(!0),s(c,null,m(N.value,(a,e)=>(n(),s("p",{key:e,class:"pr-5"},i(a.name)+": "+i(a.personCount||"_")+" 人, "+i(a.votedCount||"_")+" 票",1))),128))]),u(h,{"table-columns":T,data:v(G)},null,8,["data"])])}}});export{z as default};
